<!DOCTYPE html>
<html lang="en">
<head>
    <title>Benefits Connect</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="css/custom.css" rel="stylesheet" type="text/css" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="js/gitana.min.js" type="text/javascript"></script>
    <!--<script type="text/javascript" src="_lib/gitana/gitana.min.js"></script>-->
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.0/handlebars.js"></script>
    <link type="text/css" href="https://code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.css"
        rel="stylesheet" />
    <script type="text/javascript" src="https://code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.js"></script>
    <script src="ckeditorFull/ckeditor.js" type="text/javascript"></script>
    <style>
        .alpaca-container-item
        {
            background-color: #eeeeee;
        }
        .alpaca-field-object
        {
            border: 2px solid black;
        }
        .alpaca-container-label
        {
            background-color: #dddddd;
        }
        .alpaca-field-array
        {
            background-color: #828282;
        }
        
        #logout 
        {
            color:Blue;
            
        }
    </style>
    
    <link href="css/jquery-ui.css" rel="stylesheet" type="text/css" />
    <script src="js/jquery-ui.min.js" type="text/javascript"></script>
        <!-- clickjacking script-->
    <style>
        html
        {
            display: none;
        }
    </style>
    <script>
        if (self == top) {
            console.log("Clickjacking test passed");
            document.documentElement.style.display = 'block';
        } else {
            console.log("Clickjacking test failed");
            top.location = self.location;
        }
    </script>
</head>
<body onload="checkCookie()">
    <div class="container-fluid" style="background-color: #00467f; height: 91px">
        <div class="container">
            <div class="row">
                <div class="col-sm-12">
                    <img src="images/benefitsConnect.png" alt="Image" style="margin-top: 33px">
                    <img src="images/bostonScientific.png" style="float: right; margin: 20px 50px" />
                    
                </div>
            </div>
        </div>
    </div>

    <p id = "logout" onclick="logout()" style="cursor:pointer">logout</p>


    <div id="loginContainer">
    </div>
    <div class="container landingpage">
        <!-- tabbed area------------------>
        <ul class="nav nav-tabs">
            <li class="active"><a data-toggle="tab" href="#home">Edit Page</a></li>
            <li><a data-toggle="tab" href="#menu1">Manage PDF's</a></li>
        </ul>
        <div class="tab-content">
            <div id="home" class="tab-pane fade in active">
                <div id="myDropdown">
                </div>
                <div id="myform" style="display: block">
                </div>
            </div>
            <div id="menu1" class="tab-pane fade">
                <!-----------------------------------upload content goes here------------------>
                <form action="" method="post" enctype="multipart/form-data"
                name="frmeditSubmitForm5" id="frmeditSubmitForm5">
                <div>
                    <br />
                    <label for="myFileUpload5">
                        You may use this form to upload pdf (Adobe Acrobat) resources to your document library.
                        Select the pdf by clicking on the 'Choose File' Button. Give the pdf a
                        user friendly name. It should be lowercase with no spaces. Then click 'Submit to upload
                        your pdf file to the library. 
                    </label>
                    <br />
                    <input type="file" id="myFileUpload5" accept="application/pdf" name="myFileUpload5">
                    <br />
                    <label>
                        Give a name to your pdf (lowercase, no spaces ex: my_new_pdf). Refer to the pdf in the page editor by using this template: [Template goes here]<br>
                        <input type="text" name="uploadFilename5" id="uploadFilenameEdit5">
                    </label>
                </div>
                <div>
                    <input id="mySubmitButton" name="mySubmit" type="submit" value="Submit">
                </div>
                </form>
                <script>
                    $("#frmeditSubmitForm5").submit(function (event) {
                        alert('Resource Uploaded');
                        event.preventDefault(); // Prevent the form from submitting via the browser.
                        submitForm();
                    });   
                </script>
                <!------------------------upload content ends here------------------------>
            </div>
        </div>
    </div>
    <br>
    <footer class="container-fluid text-center landingfooter">
      <p>Aon</p>
    </footer>

    <script>





        var platform;
        var repository;
        var branch;
        var node;
        var repositoryId = 'e083f23fc5141afe5d22';
        var branchId = 'fcf1c3fb882fd40ecf97';
        var nodeId = '5b5019bc3683e8438699'; //counter node
        var schemaSource;
        var optionsSource;
        var dataSource;
        //var pageIdToLoad = "21f5c2a082ab59f6391b";
        var pageIdToLoad;
        var username;
        var password;


        
       
        
      


        function getPage(callback) {

//            var config = {
//            "username": username,
//            "password": password,
//            "baseURL": "/proxy"
//                    }

        var config = {
            "clientKey": "106d6b42-46e7-4f54-9a52-7ceed8e682b4",
            "clientSecret": "It+QMtokAs7f8k5LB3hzgnNGnrR6n99/q3PpxkszdFNIVoU+BD6C7Y68s6S6fNiY2xgkSbBQlCpDJp98AWWPCap2MaNR+F6nk1H44gFAKCA=",
            "username": username,
            "password": password,
            "baseURL": "https://api.cloudcms.com",
            "application": "aab44469e1c69b575aad"
        }
       

            $("#dialog").dialog("close");

            Gitana.connect(config, function (err) {
                if (err) {
                    console.log("Error: " + err + window.location.href);
                    //$("#loading-image").css('display', 'none');

                    $("#lblLoginLable").html("Username or password are incorrect. Please try again.");
                    $("#dialog").dialog("open");
                    return;

                }
            }).then(function () {
            platform = this;
                document.cookie = "username=" + username;
                document.cookie = "password=" + password;

                this.readRepository(repositoryId).then(function () {
                repository = this;


                    this.readBranch(branchId).then(function () {
                    branch = this;
                    /*
                            node = this.readNode(pageIdToLoad).then(function () {
                                callback && callback();

                            });
                        
                        */

                    });
                });
            });
        }

        var myData = {
            /*"0fb318d0041cb9bd0a13": "test",*/
            "5c5fb3b173fbb1185b4d": "medical",
            "1797d83ab34843aa7ab9": "medical-hmo",
            "52bbfd6e6174e9ca77f7": "credit-union",
            "a652ad09a0a4462255bb": "dental",
            "0db105fc906afd2a8494": "medical-consumer",
            "c2417312cad4bf36cce6": "gesop",
            "abc86af69ab6477794ab": "medical-hsa",
            "487777503a2025303fec": "medical-wellness",
            "f2566b4b4bd18f383249": "medical-ppo",
            "b883c2dca4f15f11019f": "life-accident",
            "ee95b728317147bb79d6": "employee-asst",
            "f5be44d832f9e77d6e85": "leave-absence",
            "b073cb57ee6187722d75": "educational-asst",
            "614e4f07b7874ccb7a08": "maternity-resources",
            "b825e1ee2d42b2767c35": "adoption-asst",
            "e5a18ae298b211790f7e": "workflex",
            "a80289b42b88610a7651": "voluntary",
            "4b948eecd3345ced09bc": "vision",
            "252be9349d6efd0312d4": "new_hires",
            "89d455783efde8f39be7": "myResources",
            "21f5c2a082ab59f6391b": "401k-plan",
            "67a22456135d7668e21a": "fsa-hsa",
            /*"0ff355a9f5e994f836bc": "modern-family"*/
        }

        $("#myDropdown").alpaca({
            "options": {
                "label": "What page would you like to edit?",
                "type": "select",
                //"dataSource": { "5c5fb3b173fbb1185b4d": "medical.html" }
                "dataSource": myData
            }
        });

        $("#myDropdown").change(loadPage);

        function loadPage() {
            
            pageIdToLoad = $("#alpaca1").val() || "21f5c2a082ab59f6391b";
            //getPage(showForm);
            reShowForm();
        }

        function reShowForm() {

            node = branch.readNode(pageIdToLoad).then(function () {
                showForm();
            });
        }


        function showForm() {
            $("#myform").html("");
            $("#myform").alpaca({
                "view": "bootstrap-edit",
                "data": node,
                "schema": {
                    "title": "Edit Page",
                    "type": "object",
                    "properties": {
                        /*"name": {
                            "type": "string",
                            "title": "Page Name"
                        },*/
                        "body": {
                            "type": "string",
                            "title": "Main Body"
                        },
                        /*"leftImage": {
                            "type": "string",
                            "title": "Left Sidebar Image URL"
                        },*/
                        "links": {
                            "type": "array",
                            "title": "Helpful Links",
                            "items": {
                                "properties": {
                                    "company": {
                                        "type": "string",
                                        "title": "company"
                                    },
                                    "number": {
                                        "type": "string",
                                        "title": "number"
                                    },
                                    "link": {
                                        "type": "string",
                                        "title": "link"
                                    }
                                },
                                "type": "object"
                            }
                        },
                        "iWantTo": {
                            "type": "array",
                            "title": "Accordion Section 1",
                            "items": {
                                "properties": {
                                    "description": {
                                        "type": "string",
                                        "title": "description"
                                    },
                                    "link": {
                                        "type": "string",
                                        "title": "link"
                                    },
                                    "bullets": {
                        "items": {
                            "type": "string",
                            "title": "bulletItem"
                        },
                        "type": "array",
                        "title": "bullets"
                    }



                                },
                                "type": "object"
                            }
                        },
                        "iWantTo2": {
                            "type": "array",
                            "title": "Accordion Section 2",
                            "items": {
                                "properties": {
                                    "description": {
                                        "type": "string",
                                        "title": "description"
                                    },
                                    "link": {
                                        "type": "string",
                                        "title": "link"
                                    }
                                },
                                "type": "object"
                            }
                        }
                    },
                    "_parent": "n:node",
                    "items": {}
                },
                "options": {
                    "form": {
//                        "attributes": {
//                            "action": "http://httpbin.org/post",
//                            "method": "post"
//                        },
                        "buttons": {
                            "submit": {
                                "click": function () {
                                    var value = this.getValue();
                                    //alert(JSON.stringify(value, null, "  "));
                                    node.name = value.name;
                                    node.heading = value.heading;
                                    node.body = value.body;
                                    node.leftImage = value.leftImage;
                                    //node.links = JSON.parse($.encoder.encodeForHTML(JSON.stringify(value.links)));
                                    node.links = value.links;
                                    node.accordionSection1Header = value.accordionSection1Header;
                                    //node.iWantTo = JSON.parse($.encoder.encodeForHTML(JSON.stringify(value.iWantTo)));                             
                                    node.iWantTo = value.iWantTo;
                                    node.accordionSection2Header = value.accordionSection2Header;
                                    //node.iWantTo2 = JSON.parse($.encoder.encodeForHTML(JSON.stringify(value.iWantTo2)));
                                    node.iWantTo2 = value.iWantTo2;
                                    node.update().then(function(){alert("Form Submitted")});
                                }
                            }
                        }
                    },
                    "title": "newPageTitle",
                    "engineId": "alpaca1",
                    "fields": {
                        "name": {
                            "type": "text"
                        },
                        "body": {
                            "type": "ckeditor"
                        },
                        "image": {
                            "type": "text"
                        },
                        "links": {
                            "options": {
                                "actionBarType": "right"
                            }
                        }
                    }
                }
            });

        } //alpaca   


        //This is form upload scripting here--------------------------------------------
        var pdfContainerId = 'f2585ff41013540945ab';
        function submitForm() {
            var formData = new FormData($("#frmeditSubmitForm5")[0]);

            var authorizationHeader = platform.getDriver().getHttpHeaders()["Authorization"];
            var form = $("#frmeditSubmitForm5");

            $.ajax({
                type: "POST",
                url: "https://api.cloudcms.com/repositories/" + repositoryId + "/branches/" + branchId + "/nodes/" + pdfContainerId + "/attachments/" + ($("#uploadFilenameEdit5").val()).replace(" ", "_") + "/",
                data: formData,
                contentType: false,
                processData: false,
                headers: {
                    authorization: authorizationHeader
                }
            });
        }

        //This ends form upload scripting-----------------------------------------------


        function checkCookie() {

        if(performance.navigation.type  == 1 )
          {
            console.log('page reloaded');
            Gitana.deleteCookie("password","/secure-bsc-admin");
            Gitana.deleteCookie("username","/secure-bsc-admin");
            Gitana.deleteCookie("password","/localhost");
            Gitana.deleteCookie("username","/localhost");
            Gitana.deleteCookie("password","/");
            Gitana.deleteCookie("username","/");

          }




            console.log('checking cookies');
            var user = getCookie("username");
            var pswd = getCookie("password");
            if (user != "" && pswd != "") {
                console.log("Welcome again " + user);
                username = user;
                password = pswd;
                loadPage();
            } else {
                $("#loginContainer").append('<div id="dialog" title="Please Log In."><label>Username:</label><input id="txtUsername" name="txtUsername" type="text"><label>Password:</label><input id="txtPassword" name="txtPassword" type="password"><input id="submitButton" onclick="setCredentialsFromLogin()" name="Submit" type="button" value="Submit"><label id="lblLoginLable"></label></div>');
                $("#dialog").dialog({
                    modal: true,
                    draggable: false,
                    width: "auto",
                    position: { my: "top", at: "center", of: window },
                    create: function (event, ui) {
                        $(this).css("maxWidth", "300px");
                    }

                });


                $(".selector").dialog("open");
            }
        }

        function getCookie(cname) {
            var name = cname + "=";
            var ca = document.cookie.split(';');
            for (var i = 0; i < ca.length; i++) {
                var c = ca[i];
                while (c.charAt(0) == ' ') c = c.substring(1);
                if (c.indexOf(name) == 0) return c.substring(name.length, c.length);
            }
            return "";
        }
        function setCredentialsFromLogin() {
            username = $("#txtUsername").val();
            password = $("#txtPassword").val();
            getPage(showForm);
        }



        function logout() {
            Gitana.deleteCookie("password","/secure-bsc-admin");
            Gitana.deleteCookie("username","/secure-bsc-admin");
            Gitana.deleteCookie("password","/localhost");
            Gitana.deleteCookie("username","/localhost");
            Gitana.deleteCookie("password","/");
            Gitana.deleteCookie("username","/");

            platform.logout();
            open("alpaca2.html","_self");
        }

    </script>

    <script src="js/Class.create.js" type="text/javascript"></script>
    <script src="js/jquery-encoder-0.1.0.js" type="text/javascript"></script>


</body>
</html>
