<!DOCTYPE html>
<html lang="en">

  <head>
    <title>Benefits Connect</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
    <link href="css/custom.css" rel="stylesheet" type="text/css" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="http://www.w3schools.com/lib/w3data.js"></script>
    <script src="js/gitana.min.js" type="text/javascript"></script>
 
        <!-- handlebars -->
        <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.0.0/handlebars.js"></script>
 
        <!-- alpaca -->
        <link type="text/css" href="https://code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.css" rel="stylesheet" />
        <script type="text/javascript" src="https://code.cloudcms.com/alpaca/1.5.17/bootstrap/alpaca.min.js"></script>

<script src="ckeditor/ckeditor.js" type="text/javascript"></script>

<style>
.alpaca-container-item
{
    background-color:#eeeeee;
    
}
.alpaca-field-object 
{
    border:2px solid black;
    
}
.alpaca-container-label 
{
    background-color:#dddddd;
    
}
.alpaca-field-array {

    background-color: #828282;
}


</style>


   <script>
       var platform;
       var repository;
       var branch;
       var node;

       var repositoryId = 'e083f23fc5141afe5d22';
       var branchId = 'fcf1c3fb882fd40ecf97';
       var nodeId = '5b5019bc3683e8438699'; //counter node

       var schemaSource;
       var optionsSource;
       var dataSource;

       var pageIdToLoad;

       $(document).ready(function () {

           function getPage(callback) {

               platform = Gitana.connect({
                   "clientKey": "106d6b42-46e7-4f54-9a52-7ceed8e682b4",
                   "clientSecret": "It+QMtokAs7f8k5LB3hzgnNGnrR6n99/q3PpxkszdFNIVoU+BD6C7Y68s6S6fNiY2xgkSbBQlCpDJp98AWWPCap2MaNR+F6nk1H44gFAKCA=",
                   "username": "daae953d-a14b-4430-b715-aa72c72915e1",
                   "password": "MsdnSdDxScFjwQKr/Dd/A0qBSAHP/ZpILClCfHmhrunxlscXzylNogjJ20Zz2nPiUbMfR7JT+4CXql3Td4kJUrASeTwT9jpVFYweQ35K2xA=",
                   "baseURL": "https://api.cloudcms.com",
                   "application": "aab44469e1c69b575aad"
               }).then(function () {

                   repository = platform.readRepository(repositoryId).then(function () {

                       branch = repository.readBranch(branchId).then(function () {

                           node = branch.readNode(pageIdToLoad).then(function () {
                               callback && callback();

                           });
                       });
                   });
               });
           }

           $("#myDropdown").alpaca({
               "options": {
                   "label": "What page would you like to edit?",
                   "type": "select",
                   "dataSource": { "52bbfd6e6174e9ca77f7": "credit-union.html" }
               }
           });

           $("#myDropdown").change(loadPage);

           function loadPage() {
               pageIdToLoad = $("#alpaca1").val();

               getPage(showForm);
           }


           function showForm() {
               $("#myform").html("");
               $("#myform").alpaca({
                   "view": "bootstrap-edit",
                   "data": node,
                   "schema": {
                       "title": "Edit Page",
                       "type": "object",
                       "properties": {
                           "name": {
                               "type": "string",
                               "title": "Page Name"
                           },
                           "body": {
                               "type": "string",
                               "title": "Main Body"
                           },
                           "leftImage": {
                               "type": "string",
                               "title": "Left Sidebar Image URL"
                           },
                           "links": {
                               "type": "array",
                               "title": "Helpful Links",
                               "maxItems": 6,
                               "items": {
                                   "properties": {
                                       "company": {
                                           "type": "string",
                                           "title": "company"
                                       },
                                       "number": {
                                           "type": "string",
                                           "title": "number"
                                       },
                                       "link": {
                                           "type": "string",
                                           "title": "link"
                                       }
                                   },
                                   "type": "object"
                               }
                           },
                           "iWantTo": {
                               "type": "array",
                               "title": "Accordion Section 1",
                               "items": {
                                   "properties": {
                                       "description": {
                                           "type": "string",
                                           "title": "description"
                                       },
                                       "link": {
                                           "type": "string",
                                           "title": "link"
                                       }
                                   },
                                   "type": "object"
                               }
                           },
                           "iWantTo2": {
                               "type": "array",
                               "title": "Accordion Section 2",
                               "items": {
                                   "properties": {
                                       "description": {
                                           "type": "string",
                                           "title": "description"
                                       },
                                       "link": {
                                           "type": "string",
                                           "title": "link"
                                       }
                                   },
                                   "type": "object"
                               }
                           }
                       },
                       "_parent": "n:node",
                       "items": {}
                   },
                   "options": {
                       "form": {
                           "attributes": {
                               "action": "http://httpbin.org/post",
                               "method": "post"
                           },
                           "buttons": {
                               "submit": {
                                   "click": function () {
                                       var value = this.getValue();
                                       alert(JSON.stringify(value, null, "  "));
                                       node.name = "Hough",
                                 node.update();
                                   }
                               }
                           }
                       },
                       "title": "newPageTitle",
                       "engineId": "alpaca1",
                       "fields": {
                           "name": {
                               "type": "text"
                           },
                           "body": {
                               "type": "ckeditor"
                           },
                           "image": {
                               "type": "text"
                           },
                           "links": {
                               "options": {
                                   "actionBarType": "right"
                               }
                           }
                       }
                   }
               });

           } //alpaca   
       });




       //This is form upload scripting here--------------------------------------------
       var pdfContainerId = 'f2585ff41013540945ab';
       function submitForm() {
           var formData = new FormData($("#frmeditSubmitForm5")[0]);

           var authorizationHeader = platform.getDriver().getHttpHeaders()["Authorization"];
           var form = $("#frmeditSubmitForm5");

           $.ajax({
               type: "POST",
               url: "https://api.cloudcms.com/repositories/" + repositoryId + "/branches/" + branchId + "/nodes/" + pdfContainerId + "/attachments/" + ($("#uploadFilenameEdit5").val()).replace(" ", "_") + "/",
               data: formData,
               contentType: false,
               processData: false,
               headers: {
                   authorization: authorizationHeader
               }
           });
       }




       //This ends form upload scripting-----------------------------------------------
 </script>

   <script src="ga/google-analytics.js" type="text/javascript"></script>       
  </head>

  <body>

    <div w3-include-html="header.html">
    </div>
    <script>
        w3IncludeHTML();
    </script>

   

    

    
    <div class="container landingpage">
    <!-- tabbed area------------------>
    <ul class="nav nav-tabs">
  <li class="active"><a data-toggle="tab" href="#home">Edit Page</a></li>
  <li><a data-toggle="tab" href="#menu1">Manage PDF's</a></li>

</ul>

<div class="tab-content">
  <div id="home" class="tab-pane fade in active">
    <div id="myDropdown"></div>
    <div id="myform" style="display:block"></div>
  </div>
  <div id="menu1" class="tab-pane fade">
  <!-----------------------------------upload content goes here------------------>
    <form action="http://httpbin.org/post" method="post" enctype="multipart/form-data"
        name="frmeditSubmitForm5" id="frmeditSubmitForm5">
        <div>
            <label for="myFileUpload5">
                Upload a pdf file to your repository</label>
            <input type="file" id="myFileUpload5" name="myFileUpload5">
            <label>
                Give a name to your pdf (lowercase, no spaces ex: my_new_pdf)<br>
                <input type="text" name="uploadFilename5" id="uploadFilenameEdit5">
            </label>
        </div>
        <div>
            <input id="mySubmitButton" name="mySubmit" type="submit" value="Submit">
        </div>
        </form>

        <script>
            $("#frmeditSubmitForm5").submit(function (event) {
                alert('form submit intervention');
                event.preventDefault(); // Prevent the form from submitting via the browser.
                submitForm();
            });   
        </script>

        <!------------------------upload content ends here------------------------>
  </div>
  
</div>
<!---------------------------------------------->

    </div>
    <br>




    <footer class="container-fluid text-center landingfooter">
      <p>Footer Text</p>
    </footer>

  
  </body>

</html>
